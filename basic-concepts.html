

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic Concepts &mdash; opam-bin HEAD
 (fbdd1ec
) (2020/10/28 15:57) documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/css/fixes.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="opam-bin HEAD
 (fbdd1ec
) (2020/10/28 15:57) documentation" href="index.html"/>
        <link rel="next" title="Installation" href="installation.html"/>
        <link rel="prev" title="Introduction" href="introduction.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> opam-bin
          

          
          </a>

          
            
            
              <div class="version">
                HEAD
 (fbdd1ec
)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#binary-packages">Binary packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#relocatable-packages">Relocatable packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-structure">File Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#patches-repository-structure">Patches Repository Structure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="local-usage.html">Local Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="sharing-packages.html">Sharing Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="repositories.html">Contributed Binary Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="f-a-q.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="about-and-thanks.html">About, Thanks and Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Copyright and License</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ocamlpro/opam-bin">Devel and Issues on Github</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">opam-bin</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Basic Concepts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/basic-concepts.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-concepts">
<h1>Basic Concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h1>
<p><code class="code docutils literal"><span class="pre">opam-bin</span></code> is a simple framework to use <code class="code docutils literal"><span class="pre">opam</span></code> with binary packages.
The framework is composed of:</p>
<ul class="simple">
<li>A set of repositories containing binary packages. These repositories
will only work for people using the same distribution on the same
architecture. You will need to select carefully the right one if
you want to use them. These repositories are provided by external
contributors. <a class="reference external" href="repositories.html">Check this list</a></li>
<li>A <code class="code docutils literal"><span class="pre">git</span></code> repository containing patches to make <code class="code docutils literal"><span class="pre">opam</span></code>
packages relocatable. Relocatable packages are needed because binary
packages will be installed in different directories by different
users. The repository is available here:
<a class="reference external" href="https://github.com/ocamlpro/relocation-patches">https://github.com/ocamlpro/relocation-patches</a></li>
<li>A tool called <code class="code docutils literal"><span class="pre">opam-bin</span></code> to create and use binary packages,
available here: <a class="reference external" href="https://github.com/ocamlpro/opam-bin">https://github.com/ocamlpro/opam-bin</a></li>
</ul>
<p>If you only want to use a repository of binary packages and not create
them, you will only need to access one of the binary repositories in
the first item, without the need for <code class="code docutils literal"><span class="pre">opam-bin</span></code>.
If you want to develop with a cache of binary packages, or to create
repositories of binary packages, then you need to install <code class="code docutils literal"><span class="pre">opam-bin</span></code>.</p>
<div class="section" id="binary-packages">
<h2>Binary packages<a class="headerlink" href="#binary-packages" title="Permalink to this headline">¶</a></h2>
<p>Binary packages created by <code class="code docutils literal"><span class="pre">opam-bin</span></code> follow the following convention:</p>
<ul>
<li><p class="first">The binary package created from package <code class="code docutils literal"><span class="pre">$NAME.$VERSION</span></code> is called
<code class="code docutils literal"><span class="pre">$NAME.$VERSION+bin+$HASH</span></code>, where $HASH is a unique hash. This hash
is used because dependencies between binary packages are strict and
cannot be changed.</p>
</li>
<li><p class="first">An alias package called <code class="code docutils literal"><span class="pre">$NAME+bin.$VERSION</span></code> is also generated, pointing
to <code class="code docutils literal"><span class="pre">$NAME.$VERSION+bin+$HASH</span></code>. You can use it to install
the corresponding binary package. For example:</p>
<div class="highlight-ocaml"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">opam</span> <span class="n">install</span> <span class="n">ocamlfind</span><span class="o">+</span><span class="n">bin</span>
</pre></div>
</div>
</li>
</ul>
<p>When <code class="code docutils literal"><span class="pre">opam-bin</span></code> is installed and you ask to install a package
<code class="code docutils literal"><span class="pre">NAME.VERSION</span></code>, OPAM may decide to install the source package instead
of the binary package. OPAM will always select the source package if
you have a <code class="code docutils literal"><span class="pre">&quot;NAME&quot;</span> <span class="pre">{</span> <span class="pre">=</span> <span class="pre">VERSION</span> <span class="pre">}</span></code> dependencies asking for the package.</p>
<p>HOWEVER, <code class="code docutils literal"><span class="pre">opam-bin</span></code> will detect if there is a corresponding binary
package, and if it is the case, it will install the binary package
instead of compiling the package (<code class="code docutils literal"><span class="pre">opam</span></code> will still show you the build
steps, but these build steps will actually not be executed).</p>
</div>
<div class="section" id="relocatable-packages">
<h2>Relocatable packages<a class="headerlink" href="#relocatable-packages" title="Permalink to this headline">¶</a></h2>
<p>Binary packages have to be relocatable to be installed in many
different locations. Most OCaml packages are relocatable, but some of
them are not. For example, <code class="code docutils literal"><span class="pre">ocaml-base-compiler</span></code>,
<code class="code docutils literal"><span class="pre">ocaml-variants</span></code>, <code class="code docutils literal"><span class="pre">ocamlfind</span></code>, <code class="code docutils literal"><span class="pre">ocamlbuild</span></code>, etc.
If you want to create binary packages, you should only use relocatable
packages.</p>
<p>We provide a specific <code class="code docutils literal"><span class="pre">git</span></code> repository containing patches to
make packages relocatable. This repository is available in the
project:</p>
<p><a class="reference external" href="https://github.com/OCamlPro/relocation-patches/">https://github.com/OCamlPro/relocation-patches</a></p>
<p>It can be used automatically by <code class="code docutils literal"><span class="pre">opam-bin</span></code> with any <code class="code docutils literal"><span class="pre">opam</span></code>
repository.</p>
<p>If you want to use or contribute to this repository, you may want to
use a local version. You will then have to set the <code class="code docutils literal"><span class="pre">patches_url</span></code>
option, for example using the <code class="code docutils literal"><span class="pre">opam-bin</span> <span class="pre">config</span></code> command:</p>
<div class="highlight-ocaml"><div class="highlight"><pre><span></span><span class="n">opam</span> <span class="n">bin</span> <span class="n">config</span> <span class="o">--</span><span class="n">patches</span><span class="o">-</span><span class="n">url</span> <span class="n">file</span><span class="o">:///</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="nc">GIT</span><span class="o">/</span><span class="n">relocation</span><span class="o">-</span><span class="n">patches</span>
</pre></div>
</div>
<p>Currently, it contains patches for the following packages:</p>
<ul class="simple">
<li>apron</li>
<li>menhir</li>
<li>mlgmpidl</li>
<li>ocaml-base-compiler</li>
<li>ocaml-variants</li>
<li>ocamlbuild</li>
<li>ocaml-config</li>
<li>ocamlfind</li>
<li>ocamlfind</li>
<li>ocaml-variants</li>
</ul>
<p><code class="code docutils literal"><span class="pre">opam-bin</span></code> will try to find the best patch for a given source
package. For that, it will use the patch with the highest version less
or equal to the current package version. If <code class="code docutils literal"><span class="pre">opam-bin</span></code> cannot
find such a patch, it will disable itself automatically and let
<code class="code docutils literal"><span class="pre">opam</span></code> build the package without using/creating binary packages.</p>
</div>
<div class="section" id="file-structure">
<h2>File Structure<a class="headerlink" href="#file-structure" title="Permalink to this headline">¶</a></h2>
<p><code class="code docutils literal"><span class="pre">opam-bin</span></code> creates the following file structure in the
<code class="code docutils literal"><span class="pre">$HOME/.opam/</span></code> directory (or <code class="code docutils literal"><span class="pre">OPAMROOT</span></code>):</p>
<ul class="simple">
<li><code class="code docutils literal"><span class="pre">~/.opam/</span></code><ul>
<li><code class="code docutils literal"><span class="pre">plugins/opam-bin/</span></code><ul>
<li><code class="code docutils literal"><span class="pre">opam-bin.exe</span></code> This file is the executable of
<code class="code docutils literal"><span class="pre">opam-bin</span></code> used in <code class="code docutils literal"><span class="pre">opam</span></code> wrappers.</li>
<li><code class="code docutils literal"><span class="pre">opam-bin.log</span></code> This file is an internal log of
<code class="code docutils literal"><span class="pre">opam-bin</span></code> used for debugging its behavior.</li>
<li><code class="code docutils literal"><span class="pre">cache/</span></code> This directory contains a cache of the archives
of the binary packages created locally. It is necessary as the
URLs in the <code class="code docutils literal"><span class="pre">opam</span></code> files are not correct before the
archives have been uploaded to their final location.</li>
<li><code class="code docutils literal"><span class="pre">store/</span></code> This directory contains the files that have to be
published to share binary packages between users/computers.<ul>
<li><code class="code docutils literal"><span class="pre">archives/</span></code> This directory contains all the archives of
the binary packages that have been created locally.</li>
<li><code class="code docutils literal"><span class="pre">repo/</span></code> This directory contains an <code class="code docutils literal"><span class="pre">opam</span></code>
repository that exposes the binary packages locally
created. It is used locally by <code class="code docutils literal"><span class="pre">opam</span></code>, and can be shared
with other users/computers.</li>
</ul>
</li>
</ul>
</li>
<li><code class="code docutils literal"><span class="pre">SWITCH/</span></code><ul>
<li><code class="code docutils literal"><span class="pre">etc/opam-bin/packages/</span></code> This directory contains, for every
binary package that has been installed or built in the switch, its
binary version.</li>
<li><code class="code docutils literal"><span class="pre">.opam-switch/opam-bin</span></code> This directory contains information
on the packages viewed by <code class="code docutils literal"><span class="pre">opam-bin</span></code>. In particular, it contains
the <code class="code docutils literal"><span class="pre">opam</span></code> file used to generate the binary package, the
package patch if one was applied.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="patches-repository-structure">
<h2>Patches Repository Structure<a class="headerlink" href="#patches-repository-structure" title="Permalink to this headline">¶</a></h2>
<p>The <code class="code docutils literal"><span class="pre">git</span></code> repository of patches follows the following structure:</p>
<ul class="simple">
<li><code class="code docutils literal"><span class="pre">patches/</span></code> directory:<ul>
<li><code class="code docutils literal"><span class="pre">NAME/</span></code> where <code class="code docutils literal"><span class="pre">NAME</span></code> is the name of a package<ul>
<li><code class="code docutils literal"><span class="pre">VERSION.patch</span></code> where <code class="code docutils literal"><span class="pre">VERSION</span></code> is the minimal version
to which this patch can be applied.</li>
<li><code class="code docutils literal"><span class="pre">NAME.alias</span></code> where <code class="code docutils literal"><span class="pre">NAME</span></code> is another package name,
whose patches should be used for this package.</li>
<li><code class="code docutils literal"><span class="pre">VERSION=.patch</span></code> where <code class="code docutils literal"><span class="pre">VERSION</span></code> is a version that should
exactly match the version of the package on which it should be applied</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="installation.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, OCamlPro &amp; Origin Labs SAS. &lt;contact@ocamlpro.com&gt;.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'HEAD (fbdd1ec) (2020/10/28 15:57)',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>